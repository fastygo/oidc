---
###############################################################
#                   Authelia Configuration                    #
###############################################################

server:
  address: 'tcp://0.0.0.0:9091'
  buffers:
    read: 4096
    write: 4096
  timeouts:
    read: 6s
    write: 6s
    idle: 30s

log:
  level: 'info'
  format: 'text'
  file_path: '/config/authelia.log'
  keep_stdout: true

theme: 'dark'

# This URL is used for redirections
default_redirection_url: 'https://authelia.app-server.ru'

totp:
  disable: false
  issuer: 'authelia.com'
  algorithm: 'sha1'
  digits: 6
  period: 30
  skew: 1
  secret_size: 32

# Uncomment to enable Duo Push notifications
# duo_api:
#   hostname: 'api-xxxxxxxx.duosecurity.com'
#   integration_key: 'ABCDEFGHIJKLMNOP'
#   secret_key: 'your-secret-key-here'

authentication_backend:
  password_reset:
    disable: false
  refresh_interval: '5m'
  
  file:
    path: '/config/users.yml'
    watch: true
    password:
      algorithm: 'argon2'
      argon2:
        variant: 'argon2id'
        iterations: 3
        memory: 65536
        parallelism: 4
        key_length: 32
        salt_length: 16

# Access Control Rules
access_control:
  default_policy: 'two_factor'
  
  rules:
    # Allow public access to Authelia endpoints
    - domain: 
        - 'authelia.app-server.ru'
        - 'authelia-aswggw4wk0s8o408gcskss8o.app-server.ru'
      policy: 'bypass'
      resources:
        - '^/api/.*'
        - '^/.well-known/.*'
    
    # Require two-factor authentication for all services
    - domain:
        - '*.app-server.ru'
      policy: 'two_factor'
    
    # Example: Admin-only access
    # - domain:
    #     - 'admin.example.com'
    #   policy: 'two_factor'
    #   subject:
    #     - 'group:admin'
    
    # Example: One-factor for specific service
    # - domain:
    #     - 'public.example.com'
    #   policy: 'one_factor'

session:
  name: 'authelia_session'
  same_site: 'lax'
  expiration: '1h'
  inactivity: '5m'
  remember_me: '1M'
  
  cookies:
    - domain: 'app-server.ru'
      authelia_url: 'https://authelia.app-server.ru'
      default_redirection_url: 'https://app-server.ru'

# Rate limiting for authentication attempts
regulation:
  max_retries: 3
  find_time: '2m'
  ban_time: '5m'

# Storage backend
storage:
  # SQLite (default - good for small deployments)
  local:
    path: '/config/db.sqlite3'
  
  # PostgreSQL (recommended for production)
  # postgres:
  #   address: 'tcp://postgres:5432'
  #   database: 'authelia'
  #   username: 'authelia'
  #   password: 'your-password-here'
  #   schema: 'public'
  #   timeout: '5s'

# Notification provider
notifier:
  disable_startup_check: false
  
  # Filesystem (for testing - notifications saved to file)
  filesystem:
    filename: '/config/notifications.txt'
  
  # SMTP (recommended for production)
  # smtp:
  #   address: 'smtp://smtp.gmail.com:587'
  #   timeout: '5s'
  #   username: 'your-email@gmail.com'
  #   password: 'your-app-password'
  #   sender: 'Authelia <noreply@example.com>'
  #   identifier: 'authelia'
  #   subject: '[Authelia] {title}'
  #   startup_check_address: 'test@authelia.com'
  #   disable_require_tls: false
  #   disable_html_emails: false

# Password policy
password_policy:
  standard:
    enabled: false
    min_length: 8
    max_length: 0
    require_uppercase: true
    require_lowercase: true
    require_number: true
    require_special: true
  
  zxcvbn:
    enabled: true
    min_score: 3

# OpenID Connect Provider (OIDC)
# Uncomment to enable SSO for applications
# identity_providers:
#   oidc:
#     hmac_secret: 'your-hmac-secret-here'
#     issuer_private_key: |
#       -----BEGIN RSA PRIVATE KEY-----
#       ...
#       -----END RSA PRIVATE KEY-----
#     
#     access_token_lifespan: '1h'
#     authorize_code_lifespan: '1m'
#     id_token_lifespan: '1h'
#     refresh_token_lifespan: '90m'
#     
#     enable_client_debug_messages: false
#     enforce_pkce: 'public_clients_only'
#     
#     cors:
#       endpoints:
#         - 'authorization'
#         - 'token'
#         - 'revocation'
#         - 'introspection'
#       allowed_origins:
#         - 'https://example.com'
#       allowed_origins_from_client_redirect_uris: false
#     
#     clients:
#       - client_id: 'my-app'
#         client_name: 'My Application'
#         client_secret: '$pbkdf2-sha512$310000$...'
#         public: false
#         authorization_policy: 'two_factor'
#         redirect_uris:
#           - 'https://my-app.example.com/oauth2/callback'
#         scopes:
#           - 'openid'
#           - 'profile'
#           - 'email'
#           - 'groups'
#         grant_types:
#           - 'refresh_token'
#           - 'authorization_code'
#         response_types:
#           - 'code'
#         response_modes:
#           - 'form_post'
#           - 'query'
#           - 'fragment'
#         userinfo_signed_response_alg: 'none'

